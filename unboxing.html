<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flora-Synth | Incoming Transmission</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Editorial+New&family=JetBrains+Mono:wght@400;500&family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { serif: ['Playfair Display', 'serif'], mono: ['JetBrains Mono', 'monospace'] },
                    animation: { 'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite', 'float': 'float 6s ease-in-out infinite', 'bloom': 'bloom 1.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards' },
                    keyframes: {
                        float: { '0%, 100%': { transform: 'translateY(0) rotate(0deg)' }, '50%': { transform: 'translateY(-20px) rotate(2deg)' } },
                        bloom: { '0%': { transform: 'scale(0.8) translateY(50px)', opacity: '0', filter: 'blur(10px)' }, '100%': { transform: 'scale(1) translateY(0)', opacity: '1', filter: 'blur(0)' } }
                    }
                }
            }
        }
    </script>
    <style>
        body { background: radial-gradient(circle at 50% 50%, #f1f5f9 0%, #cbd5e1 100%); overflow: hidden; user-select: none; }
        .prism-container { perspective: 1000px; }
        .prism {
            width: 300px; height: 400px; background: linear-gradient(135deg, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0.1) 100%);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.8);
            border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.1), inset 0 0 0 1px rgba(255,255,255,0.5);
            transform-style: preserve-3d; transition: transform 0.2s ease-out; position: relative; display: flex; align-items: center; justify-content: center; overflow: hidden;
        }
        .prism-core {
            width: 150px; height: 150px; background: radial-gradient(circle, rgba(192, 132, 252, 0.8) 0%, rgba(34, 211, 238, 0.4) 50%, transparent 70%); filter: blur(30px); animation: pulse 3s infinite;
        }
        .progress-ring__circle { transition: stroke-dashoffset 0.1s linear; transform: rotate(-90deg); transform-origin: 50% 50%; }
        .revealed-flower { opacity: 0; position: absolute; transform-origin: bottom center; }
        .note-card { transform: translateY(100%); transition: transform 0.8s cubic-bezier(0.16, 1, 0.3, 1); }
        .note-card.visible { transform: translateY(0); }
    </style>
</head>
<body class="h-screen w-full flex items-center justify-center relative">

    <div id="lock-screen" class="z-50 flex flex-col items-center gap-12 transition-all duration-700">
        <div class="prism-container">
            <div id="prism" class="prism animate-float">
                <div class="prism-core"></div>
                <div class="absolute inset-0 flex flex-col items-center justify-center text-slate-500">
                    <i data-lucide="lock" class="w-8 h-8 mb-4 opacity-50"></i>
                    <span class="font-mono text-[10px] uppercase tracking-[0.3em]">Encrypted</span>
                </div>
                <div class="absolute inset-0 bg-gradient-to-tr from-transparent via-white/30 to-transparent skew-x-12 opacity-50"></div>
            </div>
        </div>

        <div class="relative">
            <button id="unlock-btn" class="w-20 h-20 rounded-full bg-white flex items-center justify-center shadow-lg relative z-10 active:scale-95 transition-transform">
                <i data-lucide="fingerprint" class="w-8 h-8 text-slate-800"></i>
            </button>
            <svg class="absolute -top-2 -left-2 w-24 h-24 pointer-events-none z-0">
                <circle class="text-slate-200" stroke-width="2" stroke="currentColor" fill="transparent" r="46" cx="48" cy="48"/>
                <circle id="progress-ring" class="text-purple-500 progress-ring__circle" stroke-width="2" stroke="currentColor" fill="transparent" r="46" cx="48" cy="48" stroke-dasharray="289" stroke-dashoffset="289" stroke-linecap="round"/>
            </svg>
            <p class="absolute -bottom-10 left-1/2 -translate-x-1/2 w-max font-mono text-[10px] text-slate-400 uppercase tracking-widest animate-pulse">Hold to Materialize</p>
        </div>
    </div>

    <div id="content-stage" class="absolute inset-0 hidden flex-col items-center justify-center">
        <div class="absolute inset-0 bg-gradient-to-t from-white via-transparent to-transparent opacity-0 transition-opacity duration-1000" id="light-wash"></div>

        <div class="relative w-full max-w-md h-[500px] flex items-end justify-center pb-20 scale-90">
            <div class="relative w-64 h-80 bg-white/30 backdrop-blur-md border border-white/60 rounded-[60px] shadow-2xl z-10 revealed-flower animate-bloom">
                <div class="absolute bottom-4 left-4 right-4 h-24 bg-cyan-100/40 rounded-[30px] blur-sm"></div>
                <div id="flower-target" class="absolute inset-0 overflow-visible"></div>
            </div>
        </div>

        <div id="note-card" class="absolute bottom-0 w-full max-w-md bg-white rounded-t-3xl shadow-[0_-10px_40px_rgba(0,0,0,0.1)] p-8 note-card z-30">
            <div class="flex justify-between items-start mb-6">
                <div>
                    <p class="font-mono text-[10px] text-slate-400 uppercase tracking-widest mb-2">From</p>
                    <h3 class="font-serif italic text-xl">A Secret Admirer</h3>
                </div>
                <div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center">
                    <i data-lucide="quote" class="w-4 h-4 text-slate-400"></i>
                </div>
            </div>
            <div class="space-y-2 mb-8">
                <p id="typewriter" class="font-serif text-lg leading-relaxed text-slate-800 min-h-[80px]"></p>
            </div>
            <button onclick="window.location.href='index.html'" class="w-full py-4 bg-slate-900 text-white rounded-xl font-mono text-xs uppercase tracking-widest hover:scale-[1.02] transition-transform">
                Synthesize Your Own
            </button>
        </div>
    </div>

    <div style="display:none;" id="svg-library">
        <svg id="svg-neon-tulip" viewBox="0 0 24 24" class="w-32 h-32 text-purple-500 fill-current opacity-90 drop-shadow-lg"><path d="M12 2L15 8L21 9L17 14L18 20L12 17L6 20L7 14L3 9L9 8L12 2Z" /></svg>
        <svg id="svg-crystal-lily" viewBox="0 0 24 24" class="w-32 h-32 text-cyan-500 fill-current opacity-90 drop-shadow-lg"><circle cx="12" cy="12" r="6" /><path d="M12 2V6M12 18V22M2 12H6M18 12H22" /></svg>
        <svg id="svg-void-rose" viewBox="0 0 24 24" class="w-32 h-32 text-pink-500 fill-current opacity-90 drop-shadow-lg"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
        <svg id="svg-sun-fern" viewBox="0 0 24 24" class="w-32 h-32 text-yellow-500 fill-current opacity-90 drop-shadow-lg"><path d="M12 2L2 22H22L12 2Z" /></svg>
    </div>

    <script>
        lucide.createIcons();
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        // --- AUDIO: TENSION & RELEASE ---
        let tensionOsc, tensionGain;
        
        function startTension() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            tensionOsc = audioCtx.createOscillator();
            tensionGain = audioCtx.createGain();
            tensionOsc.connect(tensionGain);
            tensionGain.connect(audioCtx.destination);
            
            tensionOsc.type = 'sawtooth';
            tensionOsc.frequency.setValueAtTime(50, audioCtx.currentTime);
            tensionOsc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 2); // Pitch rising
            tensionGain.gain.setValueAtTime(0, audioCtx.currentTime);
            tensionGain.gain.linearRampToValueAtTime(0.05, audioCtx.currentTime + 1);
            tensionOsc.start();
        }

        function stopTension() {
            if (tensionOsc) {
                tensionGain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.1);
                tensionOsc.stop(audioCtx.currentTime + 0.1);
            }
        }

        function playShatter() {
            // Glass break sound
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(3000, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 1.5);
            osc.start();
            osc.stop(audioCtx.currentTime + 1.5);
            
            // Boom
            const bass = audioCtx.createOscillator();
            const bassGain = audioCtx.createGain();
            bass.connect(bassGain);
            bassGain.connect(audioCtx.destination);
            bass.frequency.setValueAtTime(100, audioCtx.currentTime);
            bass.frequency.exponentialRampToValueAtTime(30, audioCtx.currentTime + 1);
            bassGain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            bassGain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 2);
            bass.start();
            bass.stop(audioCtx.currentTime + 2);
        }

        // --- URL DECODER ---
        const urlParams = new URLSearchParams(window.location.search);
        const encodedData = urlParams.get('b');
        let bouquetData = [];
        
        if (encodedData) {
            try {
                const jsonStr = atob(encodedData);
                bouquetData = JSON.parse(jsonStr);
            } catch (e) {
                console.error("Data corruption in ether.");
            }
        }

        // 3D Prism Tilt
        const prism = document.getElementById('prism');
        document.addEventListener('mousemove', (e) => {
            const x = (window.innerWidth / 2 - e.pageX) / 20;
            const y = (window.innerHeight / 2 - e.pageY) / 20;
            prism.style.transform = `rotateY(${x}deg) rotateX(${y}deg)`;
        });

        // Unlock Logic
        const btn = document.getElementById('unlock-btn');
        const ring = document.getElementById('progress-ring');
        const circumference = ring.r.baseVal.value * 2 * Math.PI;
        let progress = 0;
        let animationFrame;
        let isHolding = false;

        const startHold = (e) => {
            e.preventDefault();
            isHolding = true;
            startTension();
            loop();
            btn.classList.add('scale-90');
        };

        const endHold = () => {
            isHolding = false;
            stopTension();
            cancelAnimationFrame(animationFrame);
            if(progress < 100) {
                const reverse = () => {
                    if(progress > 0 && !isHolding) {
                        progress -= 4;
                        setProgress(progress);
                        requestAnimationFrame(reverse);
                    }
                };
                reverse();
                btn.classList.remove('scale-90');
            }
        };

        btn.addEventListener('mousedown', startHold);
        btn.addEventListener('touchstart', startHold);
        window.addEventListener('mouseup', endHold);
        window.addEventListener('touchend', endHold);

        function setProgress(percent) {
            const offset = circumference - (percent / 100) * circumference;
            ring.style.strokeDashoffset = offset;
        }

        function loop() {
            if (isHolding) {
                progress += 1.5;
                setProgress(progress);
                if(progress > 80) prism.style.transform = `translate(${Math.random()*4 - 2}px, ${Math.random()*4 - 2}px)`;
                if (progress >= 100) {
                    reveal();
                    return;
                }
                animationFrame = requestAnimationFrame(loop);
            }
        }

        function reveal() {
            isHolding = false;
            stopTension();
            playShatter();
            
            const lockScreen = document.getElementById('lock-screen');
            lockScreen.style.opacity = '0';
            lockScreen.style.transform = 'scale(1.5) filter(blur(20px))';
            setTimeout(() => { lockScreen.style.display = 'none'; }, 700);

            const stage = document.getElementById('content-stage');
            stage.classList.remove('hidden');
            stage.classList.add('flex');
            
            // RENDER FLOWERS
            const target = document.getElementById('flower-target');
            
            if (bouquetData.length === 0) {
                // Default if empty
                bouquetData = [{type:'neon-tulip', x:100, y:100, r:-10, s:1}, {type:'void-rose', x:160, y:120, r:10, s:1.1}];
            }

            bouquetData.forEach((flower, index) => {
                const el = document.createElement('div');
                const svgTemplate = document.getElementById(`svg-${flower.type}`);
                if (svgTemplate) {
                    el.innerHTML = svgTemplate.outerHTML;
                    el.classList.add('absolute', 'animate-bloom');
                    // Positioning logic to match builder relative to vase width (approx 256px / 320px)
                    // We simply map the saved X/Y to the unboxing vase dimensions
                    el.style.left = `${flower.x}px`;
                    el.style.bottom = `${flower.y}px`;
                    el.style.transform = `translateX(-50%) rotate(${flower.r}deg) scale(${flower.s})`;
                    el.style.zIndex = 10 + index;
                    el.style.animationDelay = `${index * 0.1}s`;
                    target.appendChild(el);
                }
            });

            setTimeout(() => { document.getElementById('light-wash').style.opacity = '1'; }, 100);
            setTimeout(() => { document.getElementById('note-card').classList.add('visible'); typeMessage(); }, 1500);
        }

        const message = "I saw this and thought of you. A digital bloom that will never fade, just like my admiration for your resilience.";
        const typeContainer = document.getElementById('typewriter');
        let typeIndex = 0;
        function typeMessage() {
            if (typeIndex < message.length) {
                typeContainer.innerHTML += message.charAt(typeIndex);
                typeIndex++;
                setTimeout(typeMessage, 40);
            }
        }
    </script>
</body>
</html>
