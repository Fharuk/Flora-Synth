<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flora-Synth | Laboratory</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Editorial+New&family=JetBrains+Mono:wght@400;500&family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        serif: ['Playfair Display', 'serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: { glass: 'rgba(255, 255, 255, 0.25)' },
                    animation: { float: 'float 5s ease-in-out infinite' },
                    keyframes: { float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } } }
                }
            }
        }
    </script>
    <style>
        body {
            background: radial-gradient(circle at 50% 50%, #f8fafc 0%, #e2e8f0 100%);
            overflow: hidden; touch-action: none; user-select: none; -webkit-user-select: none;
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.6); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.8); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.05);
        }
        .flower-item { touch-action: none; }
        .flower-item:active { transform: scale(0.95); }
        .dragging-ghost {
            position: fixed; pointer-events: none; z-index: 1000; opacity: 0.9;
            transform: scale(1.2); filter: drop-shadow(0 10px 20px rgba(0,0,0,0.2));
        }
        #vase-zone { transition: all 0.3s ease; }
        #vase-zone.drag-over {
            transform: scale(1.05); box-shadow: 0 0 50px rgba(34, 211, 238, 0.3); border-color: rgba(34, 211, 238, 0.5);
        }
        .flower-in-vase {
            position: absolute; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1)); transform-origin: bottom center; pointer-events: none; 
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="h-screen w-full flex flex-col text-slate-800 relative">

    <header class="h-14 md:h-16 glass-panel flex items-center justify-between px-4 md:px-6 z-50 shrink-0">
        <div class="flex items-center gap-3">
            <a href="index.html" class="w-8 h-8 rounded-full border border-slate-300 flex items-center justify-center hover:bg-slate-200 transition-colors">
                <i data-lucide="arrow-left" class="w-4 h-4"></i>
            </a>
            <h1 class="font-serif italic text-lg md:text-xl">Bouquet <span class="text-slate-400 not-italic text-xs font-mono hidden md:inline">#DRAFT-01</span></h1>
        </div>
        <div class="flex items-center gap-3">
            <button onclick="clearVase()" class="p-2 text-slate-400 hover:text-red-500 transition-colors"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
            <button onclick="synthesize()" class="bg-slate-900 text-white px-4 py-2 rounded-full font-mono text-[10px] md:text-xs uppercase tracking-widest flex items-center gap-2 hover:scale-105 transition-transform">
                <span>Synthesize</span> <i data-lucide="send" class="w-3 h-3"></i>
            </button>
        </div>
    </header>

    <main class="flex-1 flex flex-col md:flex-row overflow-hidden relative">
        <div class="flex-1 relative flex items-center justify-center bg-grid order-1 md:order-2 pb-32 md:pb-0">
            <div class="absolute inset-0 pointer-events-none">
                <div class="absolute top-1/4 left-1/4 w-64 h-64 md:w-96 md:h-96 bg-purple-200/20 rounded-full blur-3xl animate-pulse"></div>
            </div>
            <div id="vase-zone" class="relative w-64 h-[400px] md:w-80 md:h-[500px] rounded-[50px] md:rounded-[60px] border-2 border-white/60 bg-gradient-to-b from-white/20 to-white/50 backdrop-blur-sm z-10 flex items-end justify-center">
                <div class="absolute bottom-4 left-4 right-4 h-24 md:h-32 bg-cyan-100/30 rounded-[30px] blur-sm"></div>
                <div class="absolute top-0 w-full h-8 rounded-[60px] border-t border-white/80"></div>
                <div id="bouquet-container" class="absolute inset-0 overflow-visible"></div>
                <div class="absolute -bottom-10 font-mono text-[10px] text-slate-400 uppercase tracking-widest text-center">[Drag Flowers Here]<br><span id="count">0</span>/12</div>
            </div>
        </div>

        <aside class="w-full md:w-80 h-32 md:h-full glass-panel border-0 md:border-r border-t md:border-t-0 flex flex-row md:flex-col z-40 shadow-xl order-2 md:order-1 absolute bottom-0 md:relative">
            <div class="hidden md:block p-4 border-b border-white/50 shrink-0">
                <h2 class="font-mono text-xs uppercase tracking-widest text-slate-500">Specimen Library</h2>
            </div>
            <div class="flex-1 overflow-x-auto md:overflow-y-auto overflow-y-hidden md:overflow-x-hidden p-4 flex md:grid md:grid-cols-2 gap-4 content-start hide-scrollbar">
                <div class="flower-item min-w-[80px] md:min-w-0 bg-white/50 p-2 md:p-3 rounded-xl border border-white active:bg-purple-50" data-type="neon-tulip" data-color="text-purple-500">
                    <div class="h-16 md:h-20 flex items-center justify-center pointer-events-none">
                        <svg viewBox="0 0 24 24" class="w-10 h-10 md:w-12 md:h-12 text-purple-500 fill-current opacity-80" stroke="currentColor"><path d="M12 2L15 8L21 9L17 14L18 20L12 17L6 20L7 14L3 9L9 8L12 2Z" /></svg>
                    </div>
                </div>
                <div class="flower-item min-w-[80px] md:min-w-0 bg-white/50 p-2 md:p-3 rounded-xl border border-white active:bg-cyan-50" data-type="crystal-lily" data-color="text-cyan-500">
                    <div class="h-16 md:h-20 flex items-center justify-center pointer-events-none">
                        <svg viewBox="0 0 24 24" class="w-10 h-10 md:w-12 md:h-12 text-cyan-500 fill-current opacity-80" stroke="currentColor"><circle cx="12" cy="12" r="6" /><path d="M12 2V6M12 18V22M2 12H6M18 12H22" /></svg>
                    </div>
                </div>
                <div class="flower-item min-w-[80px] md:min-w-0 bg-white/50 p-2 md:p-3 rounded-xl border border-white active:bg-pink-50" data-type="void-rose" data-color="text-pink-500">
                    <div class="h-16 md:h-20 flex items-center justify-center pointer-events-none">
                        <svg viewBox="0 0 24 24" class="w-10 h-10 md:w-12 md:h-12 text-pink-500 fill-current opacity-80" stroke="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                    </div>
                </div>
                 <div class="flower-item min-w-[80px] md:min-w-0 bg-white/50 p-2 md:p-3 rounded-xl border border-white active:bg-yellow-50" data-type="sun-fern" data-color="text-yellow-500">
                    <div class="h-16 md:h-20 flex items-center justify-center pointer-events-none">
                        <svg viewBox="0 0 24 24" class="w-10 h-10 md:w-12 md:h-12 text-yellow-500 fill-current opacity-80" stroke="currentColor"><path d="M12 2L2 22H22L12 2Z" /></svg>
                    </div>
                </div>
            </div>
        </aside>
    </main>

    <div id="modal" class="fixed inset-0 z-[60] bg-slate-900/40 backdrop-blur-sm hidden flex items-center justify-center opacity-0 transition-opacity duration-300 px-4">
        <div class="bg-white rounded-2xl p-6 md:p-8 max-w-md w-full shadow-2xl transform scale-95 transition-transform duration-300" id="modal-content">
            <div class="text-center space-y-4">
                <div class="w-14 h-14 md:w-16 md:h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i data-lucide="check" class="w-6 h-6 md:w-8 md:h-8"></i>
                </div>
                <h2 class="text-xl md:text-2xl font-serif">Synthesis Complete</h2>
                <p class="text-sm md:text-base text-slate-500 font-light">Your unique bouquet has been encrypted into a neural link.</p>
                
                <div class="grid grid-cols-1 gap-3 mt-6">
                    <a id="share-link" href="#" class="block w-full py-3 bg-slate-900 text-white rounded-lg font-mono text-xs uppercase hover:bg-slate-800 flex items-center justify-center gap-2">
                        Send to Lover <i data-lucide="arrow-right" class="w-4 h-4"></i>
                    </a>
                    <button onclick="closeModal()" class="w-full py-3 border border-slate-200 text-slate-600 rounded-lg font-mono text-xs uppercase hover:bg-slate-50">
                        Edit More
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();
        
        // --- AUDIO ENGINE (Procedural) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            if (type === 'pop') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(800, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(300, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.1);
            } else if (type === 'glass') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(2000 + Math.random()*1000, audioCtx.currentTime); // High pitch
                gainNode.gain.setValueAtTime(0.05, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.3);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.3);
            } else if (type === 'synth') {
                // Shimmer chord
                [440, 554, 659].forEach(freq => {
                    const o = audioCtx.createOscillator();
                    const g = audioCtx.createGain();
                    o.type = 'sine';
                    o.frequency.value = freq;
                    o.connect(g);
                    g.connect(audioCtx.destination);
                    g.gain.setValueAtTime(0, audioCtx.currentTime);
                    g.gain.linearRampToValueAtTime(0.05, audioCtx.currentTime + 0.1);
                    g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 2);
                    o.start();
                    o.stop(audioCtx.currentTime + 2);
                });
            }
        }

        // --- DRAG ENGINE ---
        const draggables = document.querySelectorAll('.flower-item');
        const vaseZone = document.getElementById('vase-zone');
        const bouquetContainer = document.getElementById('bouquet-container');
        const countDisplay = document.getElementById('count');
        let flowerCount = 0;
        let activeGhost = null;
        let activeSourceContent = '';
        let activeType = '';

        // DATA STORE FOR LINK
        let bouquetData = [];

        function handleStart(e, element) {
            if (e.type === 'touchstart') e.preventDefault();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            
            // Get data
            activeType = element.dataset.type;
            activeSourceContent = element.querySelector('svg').outerHTML;
            playSound('pop');

            activeGhost = document.createElement('div');
            activeGhost.classList.add('dragging-ghost');
            activeGhost.innerHTML = activeSourceContent;
            activeGhost.style.left = `${clientX - 25}px`;
            activeGhost.style.top = `${clientY - 25}px`;
            document.body.appendChild(activeGhost);
            
            if (e.type === 'touchstart') {
                document.addEventListener('touchmove', handleMove, { passive: false });
                document.addEventListener('touchend', handleEnd);
            } else {
                document.addEventListener('mousemove', handleMove);
                document.addEventListener('mouseup', handleEnd);
            }
        }

        function handleMove(e) {
            if (!activeGhost) return;
            e.preventDefault();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            activeGhost.style.left = `${clientX - 25}px`;
            activeGhost.style.top = `${clientY - 25}px`;

            activeGhost.style.display = 'none';
            const elementBelow = document.elementFromPoint(clientX, clientY);
            activeGhost.style.display = 'block';

            if (elementBelow && (elementBelow.id === 'vase-zone' || elementBelow.closest('#vase-zone'))) {
                vaseZone.classList.add('drag-over');
            } else {
                vaseZone.classList.remove('drag-over');
            }
        }

        function handleEnd(e) {
            if (!activeGhost) return;
            const clientX = e.changedTouches ? e.changedTouches[0].clientX : e.clientX;
            const clientY = e.changedTouches ? e.changedTouches[0].clientY : e.clientY;

            activeGhost.style.display = 'none';
            const elementBelow = document.elementFromPoint(clientX, clientY);
            
            if (elementBelow && (elementBelow.id === 'vase-zone' || elementBelow.closest('#vase-zone'))) {
                if (flowerCount < 12) {
                    addFlowerToVase(activeSourceContent, activeType, clientX, clientY);
                    flowerCount++;
                    countDisplay.innerText = flowerCount;
                    if (navigator.vibrate) navigator.vibrate(50);
                    playSound('glass');
                } else {
                    alert("Vase is full!");
                }
            }

            if (activeGhost) activeGhost.remove();
            activeGhost = null;
            vaseZone.classList.remove('drag-over');
            document.removeEventListener('touchmove', handleMove);
            document.removeEventListener('touchend', handleEnd);
            document.removeEventListener('mousemove', handleMove);
            document.removeEventListener('mouseup', handleEnd);
        }

        draggables.forEach(item => {
            item.addEventListener('touchstart', (e) => handleStart(e, item), { passive: false });
            item.addEventListener('mousedown', (e) => handleStart(e, item));
        });

        function addFlowerToVase(html, type, dropX, dropY) {
            const flower = document.createElement('div');
            flower.classList.add('flower-in-vase');
            flower.innerHTML = html;
            
            // Randomize
            const rotation = Math.floor(Math.random() * 60 - 30);
            const scale = (0.8 + Math.random() * 0.4).toFixed(2);
            
            const vaseRect = vaseZone.getBoundingClientRect();
            let relX = dropX - vaseRect.left;
            relX = Math.max(20, Math.min(relX, vaseRect.width - 20));
            const relY = Math.floor(80 + Math.random() * 100);

            // SAVE DATA
            bouquetData.push({ type, x: relX, y: relY, r: rotation, s: scale });

            flower.style.left = `${relX}px`;
            flower.style.bottom = `${relY}px`;
            flower.style.transform = `translateX(-50%) rotate(${rotation}deg) scale(${scale})`;
            flower.style.zIndex = 10 + flowerCount;
            flower.style.animation = `float ${3 + Math.random()}s ease-in-out infinite`;
            flower.style.animationDelay = `${Math.random() * 2}s`;
            bouquetContainer.appendChild(flower);
        }

        function clearVase() {
            bouquetContainer.innerHTML = '';
            flowerCount = 0;
            countDisplay.innerText = 0;
            bouquetData = [];
        }

        function synthesize() {
            playSound('synth');
            const modal = document.getElementById('modal');
            const modalContent = document.getElementById('modal-content');
            
            // ENCODE DATA TO URL
            const jsonStr = JSON.stringify(bouquetData);
            const encoded = btoa(jsonStr); // Simple Base64
            const shareUrl = `unboxing.html?b=${encoded}`;
            document.getElementById('share-link').href = shareUrl;

            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                modalContent.classList.remove('scale-95');
                modalContent.classList.add('scale-100');
            }, 10);
        }

        function closeModal() {
            const modal = document.getElementById('modal');
            const modalContent = document.getElementById('modal-content');
            modal.classList.add('opacity-0');
            modalContent.classList.remove('scale-100');
            modalContent.classList.add('scale-95');
            setTimeout(() => { modal.classList.add('hidden'); }, 300);
        }
    </script>
</body>
</html>
